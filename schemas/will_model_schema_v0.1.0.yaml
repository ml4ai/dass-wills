
# TODO
#   (*) Figure out how to support Union type (e.g., OneOf) in OpenAPI

openapi: 3.0.0

info:
  title: DASS Will Model Schema
  description: |
    OpenAPI-style specification of the Will Model Schema

  contact:
    name: Salena Torres Ashton and Clayton T. Morrison
    email: salena@arizona.edu, claytonm@arizona.edu
  license:
    name: Apache 2.0
    url: 'http://www.apache.org/licenses/LICENSE-2.0.html'
  version: "0.1.0"

paths: {}

components:

  schemas:

    WillModel:
      description: |
        Root structure of a WillModel.
      required:
        - text
        - date
        - dass_type
      properties:
        text:
          description: |
            The original raw text of the will.
          type: string
        testator:
          # description: |
          #   The Testator of the will.
          $ref: "#/components/schemas/Person"
        witnesses:
          description: |
            Array of Witnesses witnessing the will creation.
          type: array
          items:
            $ref: "#/components/schemas/Person"
        date:
          description: |
            The date of the creation or modification of the current WillModel
          type: string
          format: date
        directives:
          description: |
            Array of will Directives
          type: array
          items:
            $ref: "#/components/schemas/DirectiveBody"
        dass_type:
          type: string
          default: "WillModel"

    Person:
      description: A Person
      required:
        - name
        - id
        - dass_type
      properties:
        name:
          description: The name of the Person
          type: string
        id:
          description: A unique id for the Person, using Soundex representation
          type: string
        dass_type:
          type: string
          default: "Person"

    Asset:
      decription: An asset
      required:
        - name
        - id
        - dass_type
      properties:
        name:
          description: An asset that can be bequeathed
          type: string
        id:
          description: A unique id for an Asset
          type: string
        dass_type:
          type: string
          default: "Asset"

#    DirectiveType:
#      description: |
#        Top-level directive structure
#      properties:
#        directive_type:
#          type: string
#        body:
#          $ref: "#/components/schemas/DirectiveBody"

    DirectiveBody:
      description: |
        A DirectiveBody
      oneOf:
        - $ref: "#/components/schemas/Conditional"
        - $ref: "#/components/schemas/DirectiveStatement"

    Conditional:
      description: A condition
      required:
        - condition
        - body_if
        - body_else
        - dass_type
      properties:
        condition:
          $ref: "#/components/schemas/Predicate"
        body_if:
          $ref: "#/components/schemas/DirectiveBody"
        body_else:
          $ref: "#/components/schemas/DirectiveBody"
        dass_type:
          type: string
          default: "Conditional"

#    PrimitiveOperator:
#      oneOf:
#        - BooleanOperator
#        - ArithmeticOperator
#
#    BooleanOperator:
#      type: string
#      enum:
#        - eq
#        - lt
#        - leq
#        - gt
#        - geq
#
#    ArithmeticOperator:
#      type: string
#      enum:
#        - add
#        - sub
#        - mult
#        - div

    EnumNamedFunction:
      type: string
      enum:
        - True
        - is_alive

#    EnumModifierType:
#      type: string
#      enum:
#        - fee_simple  # Fee simple is a legal term used in real estate that means full and irrevocable ownership of land, and any buildings on that land. Fee simple is the highest form of ownership â€” it means the land is owned outright, without any limitations or restrictions other than local zoning ordinances.

    DirectiveStatement:
      oneOf:
        - $ref: "#/components/schemas/DirectiveBequeath"
        # - $ref: "#/components/schemas/SExpr"

    DirectiveBequeath:
      description: A Bequeath Directive
      required:
        - type
        - beneficiaries
        - assets
        - dass_type
      properties:
        type:
          type: string
          default: "DirectiveBequeath"
        beneficiaries:
          type: array
          items:
            $ref: "#/components/schemas/TypeBeneficiary"
        assets:
          type: array
          items:
            $ref: "#/components/schemas/Asset"
        dass_type:
          type: string
          default: "DirectiveBequeath"

    TypeBeneficiary:
      description: |
        Types that can play the role of a Beneficiary.
        This enable multiple subtypes of Beneficiary.
      oneOf:
        - $ref: "#/components/schemas/Person"

    LiteralValue:
      description: A literal value
      required:
        - type
        - value
        - dass_type
      properties:
        type:
          description: |
            The type of the literal value.
            Determines how the value string is to be interpreted.
          type: string
        value:
          description: |
            The string representation of the value.
            The string is to be interpreted according to the (value) type.
          type: string
        dass_type:
          type: string
          default: "LiteralValue"

    VariableReference:
      description: |
        A reference to a variable.
      required:
        - name
        - dass_type
      properties:
        name:
          description: The name of the Variable
          type: string
        dass_type:
          type: string
          default: "VariableReference"

    SExpr:
      description: |
        An s-expression (Polish notation): (<op> <arg>*)
      required:
        - fn
        - dass_type
      properties:
        fn:
          oneOf:
            - $ref: "#/components/schemas/EnumNamedFunction"
        args:
          type: array
          items:
            oneOf:
              - $ref: "#/components/schemas/LiteralValue"
              - $ref: "#/components/schemas/VariableReference"
              - $ref: "#/components/schemas/SExpr"
        dass_type:
          type: string
          default: "SExpr"

    Predicate:
      description: A predicate (truth-valued function)
      allOf:
        - $ref: "#/components/schemas/SExpr"
      required:
        - dass_type
      properties:
        dass_type:
          type: string
          default: "Predicate"
